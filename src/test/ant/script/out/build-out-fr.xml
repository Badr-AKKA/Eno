<project basedir="." name="enoFr">
    <property name="out-extension" value="xhtml"/>
    <property name="out-folder" value="xforms"/>
    <available file="${questionnaires-folder}/${survey-name}/xforms-specific-treatment.xsl" property="specific-treatment.present"/>

    <!-- **************************** frPostProcessing ************************************************************************** -->
    <target name="frPostProcessing">
        <switch value="${ENOParameters.Parameters.StudyUnit}">
            <case value="default">
                <xslt in="${postprocessing-input-file}"
                    out="${target-folder}/${survey-name}/${form-name}/form/form-navigation.xhtml"
                    style="${xslt.home}/post-processing/fr/browsing.xsl" force="true" classpath="${saxon.jar}">
                    <param name="labels-folder" expression="${lang-folder}/fr"/>
                </xslt>
                <if>
                    <available file="${questionnaires-folder}/${survey-name}/xforms-specific-treatment.xsl"/>
                    <then>
                        <xslt in="${target-folder}/${survey-name}/${form-name}/form/form-navigation.xhtml"
                            out="${target-folder}/${survey-name}/${form-name}/form/form.xhtml"
                            style="${questionnaires-folder}/${survey-name}/xforms-specific-treatment.xsl" force="true" classpath="${saxon.jar}">
                            <param name="properties-file" expression="${config-folder}/${Properties.InFormat}2fr.xml"/>
                        </xslt>
                    </then>
                    <else>
                        <xslt in="${target-folder}/${survey-name}/${form-name}/form/form-navigation.xhtml"
                            out="${target-folder}/${survey-name}/${form-name}/form/form.xhtml"
                            style="${xslt.home}/post-processing/fr/fr-specific-treatment.xsl" force="true" classpath="${saxon.jar}">
                            <param name="properties-file" expression="${config-folder}/${Properties.InFormat}2fr.xml"/>
                        </xslt>
                    </else>
                </if>
            </case>
            <default>
                <!-- On rajoute les questions spécifiques Coltrane -->
                <xslt in="${postprocessing-input-file}"
                    out="${target-folder}/${survey-name}/${form-name}/form/form-questions-coltrane.xhtml"
                    style="${xslt.home}/post-processing/fr/insert-generic-questions.xsl" force="true" classpath="${saxon.jar}">
                    <param name="properties-file" expression="${config-folder}/${Properties.InFormat}2fr.xml"/>
                    <param name="parameters-file" expression="${questionnaires-folder}/${survey-name}/parameters.xml"/>
                </xslt>
                
                <!-- Adding the layer in charge of the survey's navigation by applying browsing.xsl stylesheet -->
                <xslt in="${target-folder}/${survey-name}/${form-name}/form/form-questions-coltrane.xhtml"
                    out="${target-folder}/${survey-name}/${form-name}/form/form-navigation.xhtml"
                    style="${xslt.home}/post-processing/fr/browsing.xsl" force="true" classpath="${saxon.jar}">
                    <param name="labels-folder" expression="${lang-folder}/fr"/>
                </xslt>
                
                <!-- On passe au modèle Coltrane -->
                <xslt in="${target-folder}/${survey-name}/${form-name}/form/form-navigation.xhtml"
                    out="${target-folder}/${survey-name}/${form-name}/form/form-modele-coltrane.xhtml"
                    style="${xslt.home}/post-processing/fr/modele-coltrane.xsl" force="true" classpath="${saxon.jar}">
                    <param name="mapping-file" expression="${temp-folder}/${survey-name}/mapping.xml"/>
                </xslt>
                
                <!-- On rajoute la couche liée à la navigation du questionnaire propre à Coltrane -->
                <xslt in="${target-folder}/${survey-name}/${form-name}/form/form-modele-coltrane.xhtml"
                    out="${target-folder}/${survey-name}/${form-name}/form/form-patron.xhtml"
                    style="${xslt.home}/post-processing/fr/edit-patron.xsl" force="true" classpath="${saxon.jar}">
                    <param name="properties-file" expression="${config-folder}/${Properties.InFormat}2fr.xml"/>
                    <param name="parameters-file" expression="${questionnaires-folder}/${survey-name}/parameters.xml"/>
                    <param name="metadata-file" expression="${questionnaires-folder}/${survey-name}/metadata.xml"/>
                </xslt>
                
                <if>
                    <equals arg1="${ENOParameters.Parameters.StudyUnit}" arg2="business"/>
                    <then>
                        <!-- On rajoute la partie sur l'identification -->
                        <xslt in="${target-folder}/${survey-name}/${form-name}/form/form-patron.xhtml"
                            out="${target-folder}/${survey-name}/${form-name}/form/form-identification.xhtml"
                            style="${xslt.home}/post-processing/fr/identification.xsl" force="true" classpath="${saxon.jar}"/>                        
                    </then>
                    <else>
                        <copy file="${target-folder}/${survey-name}/${form-name}/form/form-patron.xhtml"
                            tofile="${target-folder}/${survey-name}/${form-name}/form/form-identification.xhtml"/>
                    </else>
                </if>
                
                <!-- On surcharge la première page par une page d'accueil -->
                <xslt in="${target-folder}/${survey-name}/${form-name}/form/form-identification.xhtml"
                    out="${target-folder}/${survey-name}/${form-name}/form/form-accueil.xhtml"
                    style="${xslt.home}/post-processing/fr/insert-welcome.xsl" force="true" classpath="${saxon.jar}">
                    <param name="properties-file" expression="${config-folder}/${Properties.InFormat}2fr.xml"/>
                    <param name="parameters-file" expression="${questionnaires-folder}/${survey-name}/parameters.xml"/>
                    <param name="metadata-file" expression="${questionnaires-folder}/${survey-name}/metadata.xml"/>
                </xslt>
                
                <!-- On surcharge la dernière page par plusieurs pages de fin -->
                <xslt in="${target-folder}/${survey-name}/${form-name}/form/form-accueil.xhtml"
                    out="${target-folder}/${survey-name}/${form-name}/form/form-fin.xhtml"
                    style="${xslt.home}/post-processing/fr/insert-end.xsl" force="true" classpath="${saxon.jar}">
                    <param name="properties-file" expression="${config-folder}/${Properties.InFormat}2fr.xml"/>
                    <param name="parameters-file" expression="${questionnaires-folder}/${survey-name}/parameters.xml"/>
                    <param name="metadata-file" expression="${questionnaires-folder}/${survey-name}/metadata.xml"/>
                </xslt>
                
                <!-- On applique une verrue liée à chaque campagne -->
                <if>
                    <available file="${questionnaires-folder}/${survey-name}/xforms-specific-treatment.xsl"/>
                    <then>
                        <xslt in="${target-folder}/${survey-name}/${form-name}/form/form-fin.xhtml"
                            out="${target-folder}/${survey-name}/${form-name}/form/form-verrue.xhtml"
                            style="${questionnaires-folder}/${survey-name}/xforms-specific-treatment.xsl" force="true" classpath="${saxon.jar}">
                            <param name="properties-file" expression="${config-folder}/${Properties.InFormat}2fr.xml"/>
                        </xslt>
                    </then>
                    <else>
                        <copy file="${target-folder}/${survey-name}/${form-name}/form/form-fin.xhtml"
                            tofile="${target-folder}/${survey-name}/${form-name}/form/form-verrue.xhtml"/>
                    </else>
                </if>

                <!-- On fait passer une xslt pour gommer l'effet du nouvel eno sur le form produit -->
                <xslt in="${target-folder}/${survey-name}/${form-name}/form/form-verrue.xhtml"
                    out="${target-folder}/${survey-name}/${form-name}/form/form.xhtml"
                    style="${xslt.home}/post-processing/fr/fix-adherence.xsl" force="true" classpath="${saxon.jar}"/>
                
                
                <!-- Si l'on souhaite supprimer les différentes étapes -->
                <delete file="${target-folder}/${survey-name}/${form-name}/form/form-basique.xhtml"/>
                <delete file="${target-folder}/${survey-name}/${form-name}/form/form-questions-coltrane.xhtml"/>
                <delete file="${target-folder}/${survey-name}/${form-name}/form/form-navigation.xhtml"/>
                <delete file="${target-folder}/${survey-name}/${form-name}/form/form-modele-coltrane.xhtml"/>
                <delete file="${target-folder}/${survey-name}/${form-name}/form/form-patron.xhtml"/>
                <delete file="${target-folder}/${survey-name}/${form-name}/form/form-identification.xhtml"/>
                <delete file="${target-folder}/${survey-name}/${form-name}/form/form-accueil.xhtml"/>
                <delete file="${target-folder}/${survey-name}/${form-name}/form/form-fin.xhtml"/>
                <delete file="${target-folder}/${survey-name}/${form-name}/form/form-verrue.xhtml"/>
                
            </default>
        </switch>
    </target>

</project>
